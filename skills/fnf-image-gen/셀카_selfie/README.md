# 셀카 (Selfie)

> 인플루언서/셀럽 스타일 셀카 이미지 생성 - 자연스러운 일상 느낌

---

## 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              셀카 워크플로                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│    입력      │     │    분석      │     │    생성      │     │    검증      │
│              │     │              │     │              │     │              │
│ 얼굴 이미지  │────>│ 씬/분위기   │────>│ 자연스러운  │────>│ 5개 기준    │
│ 씬/분위기   │     │ 분석        │     │ 셀카 생성   │     │ + 역검증    │
│              │     │              │     │              │     │              │
└──────────────┘     └──────────────┘     └──────────────┘     └──────┬───────┘
                                                                       │
                                          ┌────────────────────────────┘
                                          │
                                          v
                           ┌─────────────────────────────┐
                           │   통과 + 너무 완벽하지 않음? │
                           └─────────────────────────────┘
                                    │           │
                              예    │           │ 아니오
                                    v           v
                           ┌───────────┐  ┌───────────────┐
                           │  결과물   │  │ 재생성 (최대2)│
                           │  이미지   │  │ + 불완전함추가│
                           └───────────┘  └───────────────┘
```

---

## 데이터 플로우

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                               분석 단계                                      │
└─────────────────────────────────────────────────────────────────────────────┘

얼굴 이미지 + 씬 요청
     │
     └──> analyze_selfie_scene() ──> 씬 분석 결과
               │
               ├── scene_type: "카페" | "거리" | "집" | "거울" | ...
               ├── lighting: "창가자연광" | "골든아워" | "플래시" | ...
               ├── mood: "여유로움" | "신남" | "은근" | "캐주얼" | ...
               ├── angle: "위에서" | "눈높이" | "거울셀카"
               └── props: ["커피잔", "폰보임", "거울", ...]


┌─────────────────────────────────────────────────────────────────────────────┐
│                               생성 단계                                      │
└─────────────────────────────────────────────────────────────────────────────┘

씬 분석 + 얼굴 이미지
     │
     └──> build_selfie_prompt()
               │
               ├── 1. 자연스러운 셀카 베이스
               │       "진짜 스마트폰 셀카, 전문 사진 아님"
               │
               ├── 2. 불완전함 주입
               │       "약간 불균일한 조명"
               │       "자연스러운 피부 질감 보임"
               │       "캐주얼한, 연출 안 된 포즈"
               │
               ├── 3. 씬/환경
               │       씬 디테일, 소품, 배경
               │
               ├── 4. 조명 스타일
               │       자연스러움, 스튜디오 아님
               │
               └── 5. 안티-AI 지시문
                       "플라스틱 피부 금지"
                       "완벽한 대칭 금지"
                       "실제 사람 느낌"
                         │
                         v
               generate_selfie()
                         │
                         ├── 얼굴 이미지 (API 직접 전달)
                         ├── 비율: "9:16" (기본)
                         └── 온도: 0.3~0.5 (자연스러움)


┌─────────────────────────────────────────────────────────────────────────────┐
│                       검증 단계 (5개 기준 + 역검증)                           │
└─────────────────────────────────────────────────────────────────────────────┘

생성 이미지 + 얼굴 참조
     │
     └──> SelfieValidator.validate()
               │
               │   ┌─────────────────────────────────────────┐
               │   │       "너무 잘 나오면 실패"              │
               │   │         역검증 원칙                      │
               │   └─────────────────────────────────────────┘
               │
               ├── 1. 리얼리즘 (35%)
               │         │
               │         ├── 실제 스마트폰 셀카처럼 보이나?
               │         ├── 자연스러운 조명?
               │         └── 일상적인 느낌?
               │
               ├── 2. 인물 보존 (25%)
               │         │
               │         ├── 동일 인물?
               │         └── 얼굴 특징 유지?
               │
               ├── 3. 시나리오 적합성 (20%)
               │         │
               │         ├── 요청한 씬과 일치?
               │         └── 적절한 소품/배경?
               │
               ├── 4. 피부 상태 (10%)
               │         │
               │         ├── 자연스러운 피부 텍스처?
               │         └── 플라스틱 느낌 없음?
               │
               └── 5. 역검증 (10%) ★ 핵심!
                         │
                         ├── 너무 완벽하면 감점!
                         ├── 약간의 불완전함 = 가산점
                         └── 스튜디오 느낌 = 큰 감점
```

---

## 모듈 구조

```
core/selfie/
├── __init__.py          # 통합 진입점
├── analyzer.py          # 씬/분위기 분석
├── generator.py         # 셀카 생성
├── prompt_builder.py    # 프롬프트 조립
├── templates.py         # 프롬프트 템플릿
└── validator.py         # 5개 기준 + 역검증

skills/fnf-image-gen/셀카_selfie/
├── README.md            # 이 문서
├── SKILL.md             # Claude용 스킬 정의
├── selfie-prompt-cheatsheet.md
└── validator.py         # 스킬용 검증기
```

---

## 핵심 원칙

### 1. 역검증 (Anti-Polish)

```
일반 검증: 품질 높을수록 좋음
셀카 검증: 너무 완벽하면 실패!

좋음 (자연스러움):
- 약간 기울어진 앵글
- 자연광의 불균일함
- 실제 피부 텍스처
- 캐주얼한 표정

나쁨 (너무 완벽함):
- 완벽한 대칭
- 스튜디오 조명
- 에어브러시된 피부
- 포즈 잡은 느낌
```

### 2. 불완전함 주입

```python
# 프롬프트에 자연스러운 불완전함 주입
"자연스러운 스마트폰 셀카:
- 약간 중심에서 벗어난 구도
- 캐주얼한, 연출 안 된 표정
- 실제 피부 질감 (모공 보임)
- 진짜 조명 (스튜디오 아님)"
```

### 3. 씬 진정성

| 씬 | 자연스러운 요소 | 어색한 요소 |
|-----|----------------|------------|
| 카페 | 커피잔 일부 보임, 창가 자연광 | 완벽한 라떼아트, 스튜디오 조명 |
| 거울 | 폰 들고 있는 손, 약간 흔들림 | 삼각대 느낌, 완벽한 포즈 |
| 길거리 | 배경에 행인, 자연스러운 햇빛 | 정리된 배경, 균일한 조명 |

---

## 사용법

### Python API

```python
from core.selfie import generate_with_validation

result = generate_with_validation(
    face_image=face_img,
    scene="아침 햇살 들어오는 아늑한 카페",
    mood="여유로운 주말 느낌",
    api_key=api_key,
    max_retries=2,
)
```

### 결과 구조

```python
{
    "image": PIL.Image,
    "score": 85,
    "passed": True,
    "criteria": {
        "realism": 88,
        "person_preservation": 92,
        "scenario_fit": 85,
        "skin_condition": 80,
        "anti_polish_factor": 75,  # 높을수록 자연스러움
    },
    "attempts": 1,
}
```

---

## 검증 기준 (5개)

| # | 항목 | 비중 | 설명 |
|---|------|------|------|
| 1 | 리얼리즘 | 35% | 실제 셀카처럼 보이나 |
| 2 | 인물 보존 | 25% | 동일 인물 유지 |
| 3 | 시나리오 적합성 | 20% | 씬/상황 일치 |
| 4 | 피부 상태 | 10% | 자연스러운 피부 |
| 5 | 역검증 | 10% | 너무 완벽하면 감점 |

**통과 조건**: 총점 ≥ 80 + 역검증 ≥ 60

---

## 씬 프리셋

| 씬 | 조명 | 앵글 | 특징 |
|-----|------|------|------|
| 카페 | 창가자연광 | 위에서 | 커피/음료, 테이블 |
| 거울 | 화장실조명 | 눈높이 | 폰 보임, 거울 프레임 |
| 길거리 | 골든아워 | 셀카봉 | 배경 보케, 행인 |
| 집 | 은은한조명 | 누워서 | 편안한, 캐주얼 |
| 차 | 대시보드광 | 운전석 | 안전벨트, 창문 |

---

## 자동 탈락 조건

- 플라스틱 피부 (에어브러시 과다)
- 완벽한 스튜디오 조명
- 포즈 잡은 모델 느낌
- 얼굴 완전히 다른 사람
- AI 특유의 대칭성

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 2.0.0 | 2026-02-11 | 모듈 분리 (core/selfie/) |
| 1.5.0 | 2026-02-10 | 역검증 추가 |
| 1.0.0 | 2026-02-08 | 초기 버전 |
